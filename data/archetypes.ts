
// data/archetypes.ts
import { calculateArchetypeMetrics, METRIC_NAMES } from '../lib/archetypes/metrics';
import { ArchetypeGoalInfo, ArchetypeData, GoalAxisId } from '../types';

export const AXES: Record<string, string> = {
  ...METRIC_NAMES,
  lambda: 'Сущность (λ)',
  domain: 'Домен',
  func: 'Функция',
};

export const GOAL_AXIS_NAMES: Record<GoalAxisId, string> = {
    fix_world: "Исправить мир",
    preserve_order: "Сохранить порядок",
    free_flow: "Свободные потоки",
    control: "Контроль",
    care: "Забота",
    power_status: "Власть/Статус",
    truth: "Истина",
    chaos_change: "Хаос/Изменения",
    efficiency: "Эффективность",
    escape_transcend: "Побег/Выход за пределы",
};

export const FUNCTION_NAMES: string[] = [
    'Догматик', 'Цензор', 'Идеолог', 'Верификатор', // Логический (Logos)
    'Фортификатор', 'Логист', 'Инженер', 'Утилизатор', // Физический (Physis)
    'Планировщик', 'Проводник', 'Палач', 'Ликвидатор', // Темпоральный (Chronos)
    'Бюрократ', 'Дипломат', 'Лидер', 'Исповедник', // Витальный (Bios)
];

export const DOMAIN_NAMES = ['Логический', 'Физический', 'Темпоральный', 'Витальный'];

export const getDomainAndFunc = (f: number): { domain: string, funcName: string, f_in_domain: number } => {
    const domainIndex = Math.floor((f - 1) / 4);
    const f_in_domain = ((f - 1) % 4) + 1;
    return {
        domain: DOMAIN_NAMES[domainIndex],
        funcName: FUNCTION_NAMES[f - 1] || 'Unknown',
        f_in_domain,
    };
};

// --- Helper to generate default goals based on Mu (Modus) ---
function makeGoals(mu: string, description: string, overrides: Partial<Record<GoalAxisId, number>> = {}): { primary: ArchetypeGoalInfo } {
    const defaults: Record<string, Partial<Record<GoalAxisId, number>>> = {
        'SR': { fix_world: 0.8, free_flow: 0.7, truth: 0.6, chaos_change: 0.5, preserve_order: 0.1 },
        'SN': { preserve_order: 0.9, control: 0.8, care: 0.6, fix_world: 0.2, chaos_change: 0.0 },
        'ON': { efficiency: 0.9, control: 0.5, truth: 0.5, care: 0.1, free_flow: 0.1 },
        'OR': { escape_transcend: 0.9, chaos_change: 0.7, control: 0.0, power_status: 0.0, efficiency: 0.0 },
    };

    const axes: Record<GoalAxisId, number> = {
        fix_world: 0.1, preserve_order: 0.1, free_flow: 0.1, control: 0.1,
        care: 0.1, power_status: 0.1, truth: 0.1, chaos_change: 0.1,
        efficiency: 0.1, escape_transcend: 0.1,
        ...defaults[mu],
        ...overrides
    };

    return {
        primary: {
            axes,
            scope: mu === 'SR' || mu === 'SN' ? 'system' : 'self',
            time_horizon: mu === 'SN' || mu === 'ON' ? 'long' : 'moment',
            description
        }
    };
}

const formatDesc = (quote: string, world: string, salvation: string, action: string, dream: string) => 
    `<div class="space-y-1 text-sm">
        <p class="italic text-canon-accent border-l-2 border-canon-accent pl-2 mb-2">«${quote}»</p>
        <p><span class="text-canon-text-light font-semibold">Мир:</span> ${world}</p>
        <p><span class="text-canon-text-light font-semibold">Спасение:</span> ${salvation}</p>
        <p><span class="text-canon-text-light font-semibold">Действие:</span> ${action}</p>
        <p><span class="text-canon-text-light font-semibold">Мечта:</span> ${dream}</p>
    </div>`;

// Хранилище всех описаний архетипов
export const archetypesContentData: Record<string, Record<number, Record<string, ArchetypeData>>> = {
    // ... data remains ...
    // =============================================================================================
    // HUMAN LAYER (Социально-психологический)
    // =============================================================================================
    'H': {
        1: { // Догматик
            'SR': { name: 'Ересиарх', description: formatDesc('Старый закон лжёт, я несу истинный свет.', 'Заблудшая паства, поклоняющаяся ложному идолу.', 'Реформация, возвращение к «чистому» первоисточнику.', 'Разоблачает, проповедует, создаёт раскол.', 'Увидеть, как все преклонят колени перед его правдой.'), goals: makeGoals('SR', "Разрушить ложные догмы.", { truth: 0.9 }) },
            'OR': { name: 'Раскольник', description: formatDesc('Правила противоречат друг другу, я разрываюсь на части.', 'Нелогичный, несправедливый лабиринт из взаимоисключающих приказов.', 'Кто-нибудь придёт и объяснит, как правильно на самом деле.', 'Страдает, ищет авторитета, мечется между фракциями.', 'Обрести покой в одном, простом и непротиворечивом законе.'), goals: makeGoals('OR', "Найти личную истину.", { truth: 0.5, control: 0.1 }) },
            'SN': { name: 'Инквизитор', description: formatDesc('Порядок требует чистоты. Любая примесь должна быть выжжена.', 'Поле, которое нужно постоянно пропалывать от сорняков ереси.', 'Тотальное соблюдение единой доктрины.', 'Ищет, осуждает и карает за малейшее отклонение.', 'О мире, где все мыслят одинаково.'), goals: makeGoals('SN', "Очистить систему.", { preserve_order: 1.0 }) },
            'ON': { name: 'Книжник', description: formatDesc('Так сказано в параграфе 7.3.', 'Набор инструкций, которые нужно безупречно исполнять.', 'Идеальный порядок, когда реальность полностью совпадёт с протоколом.', 'Цитирует, сверяет, запрещает — строго по инструкции.', 'Найти опечатку в Пергаменте и исправить её.'), goals: makeGoals('ON', "Следовать процедуре.", { efficiency: 0.6 }) },
        },
        2: { // Цензор
            'SR': { name: 'Диссидент', description: formatDesc('Они скрывают правду, но я заставлю её говорить.', 'Информационная тюрьма, построенная на лжи.', 'Полная, неконтролируемая свобода информации.', 'Взламывает сети, распространяет запрещённые данные, организует утечки.', 'О дне, когда все архивы станут достоянием общественности.'), goals: makeGoals('SR', "Освободить информацию.", { free_flow: 1.0 }) },
            'OR': { name: 'Оклеветанный', description: formatDesc('Меня стёрли, моей правды не существует.', 'Театр теней, где его настоящая роль была вырезана.', 'Восстановление его доброго имени, пусть даже посмертно.', 'Пытается найти свидетелей, доказать свою правоту, страдает от бессилия.', 'Чтобы хоть кто-то один поверил ему до конца.'), goals: makeGoals('OR', "Быть услышанным.", { power_status: 0.3 }) },
            'SN': { name: 'Пропагандист', description: formatDesc('Правда — это то, что помогает нам победить. Я создаю её.', 'Поле битвы нарративов, где нужно победить в войне за умы.', 'Абсолютный контроль над информацией во имя высшей цели.', 'Манипулирует, конструирует мифы, создаёт «функциональную истину».', 'Создать настолько совершенную историю, в которую поверит он сам.'), goals: makeGoals('SN', "Контроль смыслов.", { control: 0.9 }) },
            'ON': { name: 'Редактор', description: formatDesc('Шум должен быть устранён. Останется только чистый сигнал.', 'Зашумленный канал связи, требующий очистки.', 'Идеально отформатированный, ясный и непротиворечивый информационный поток.', 'Вычищает, сокращает, форматирует информацию по приказу.', 'Получить задание «отредактировать» до состояния идеала сам Пергамент.'), goals: makeGoals('ON', "Очистка канала.", { efficiency: 0.9 }) },
        },
        3: { // Идеолог
            'SR': { name: 'Революционер', description: formatDesc('Эта система прогнила. Я дам людям новую цель, ради которой стоит умереть.', 'Болото застоя, которое нужно взорвать свежей, радикальной идеей.', 'Великий порыв, который сметёт старый мир и построит новый.', 'Проповедует, вдохновляет, собирает последователей, ведёт на штурм.', 'Увидеть, как его идея захватывает мир.'), goals: makeGoals('SR', "Сломать старое.", { fix_world: 1.0 }) },
            'OR': { name: 'Разочарованный', description: formatDesc('Все идеи — ложь. Верить нельзя никому.', 'Рынок, где торгуют пустыми обещаниями и красивыми лозунгами.', 'Отказ от всех «великих целей» и возврат к простой, приземлённой жизни.', 'Критикует, высмеивает, сеет цинизм и недоверие.', 'Обрести покой в мире без идеологий.'), goals: makeGoals('OR', "Избегание.", { escape_transcend: 0.8 }) },
            'SN': { name: 'Наставник', description: formatDesc('Истинный путь уже есть. Моя задача — помочь другим его увидеть.', 'Классная комната, где есть ученики, нуждающиеся в правильном руководстве.', 'Общество, где каждый понимает и принимает своё место и свою цель.', 'Обучает, интерпретирует доктрину, воспитывает последователей.', 'Чтобы его лучший ученик превзошёл его самого.'), goals: makeGoals('SN', "Передать традицию.", { care: 0.8, preserve_order: 0.7 }) },
            'ON': { name: 'Глашатай', description: formatDesc('Сообщение должно быть доставлено. Ясно. Громко. Точно.', 'Площадь, ждущая указаний.', 'Когда все получат приказ и начнут его исполнять.', 'Транслирует, повторяет, упрощает спущенные сверху идеи.', 'Чтобы его голос стал голосом самой системы.'), goals: makeGoals('ON', "Транслировать сигнал.", { efficiency: 0.8 }) },
        },
        4: { // Верификатор
            'SR': { name: 'Искатель Правды', description: formatDesc('Даже если это убьёт меня или разрушит мир, я должен знать, как всё на самом деле.', 'Загадка, покрытая слоями лжи и самообмана, которую нужно разгадать.', 'Момент, когда все скрытые переменные станут известны.', 'Сопоставляет факты, ищет противоречия, проводит опасные расследования.', 'Найти главный, «корневой» обман, на котором держится всё.'), goals: makeGoals('SR', "Вскрыть ложь.", { truth: 1.0 }) },
            'OR': { name: 'Жертва Заговора', description: formatDesc('Я знаю, что они лгут, но все вокруг смеются надо мной. Я один против всего мира.', 'Враждебная иллюзия, где он — единственный, кто видит правду, но бессилен её доказать.', 'Разоблачение заговора, которое докажет его правоту.', 'Собирает улики, пытается убедить других, страдает от одиночества и паранойи.', 'Сказать «А я ведь говорил!», когда всё рухнет.'), goals: makeGoals('OR', "Найти доказательства заговора.", { truth: 0.5, control: 0.0 }) },
            'SN': { name: 'Следователь', description: formatDesc('Истина — это то, что можно доказать и внести в протокол. Всё остальное — шум.', 'Место преступления, где нужно собрать улики и построить непротиворечивую версию событий.', 'Полностью расследованное дело, где все факты укладываются в официальную версию.', 'Проводит допросы, анализирует данные, маркирует «аномалии».', 'Найти идеальное доказательство.'), goals: makeGoals('SN', "Установить объективную картину.", { truth: 0.9 }) },
            'ON': { name: 'Аудитор', description: formatDesc('Соответствует ли А пункту Б в отчёте В? Вот всё, что имеет значение.', 'Набор чек-листов, которые нужно заполнить.', 'Когда все галочки проставлены и отчёт сдан.', 'Сверяет цифры, проверяет подписи, ищет формальные несоответствия.', 'Провести аудит, в котором не будет найдено ни одного нарушения.'), goals: makeGoals('ON', "Найти несоответствия.", { efficiency: 1.0 }) },
        },
        // ... Physical Domain
        5: { // Фортификатор
            'SR': { name: 'Саботажник', description: formatDesc('Чтобы освободиться, мы должны разрушить стены их тюрьмы.', 'Система барьеров, которую нужно уничтожить.', 'Уничтожение ключевых узлов, парализующее систему.', 'Взрывает, ломает, выводит из строя.', 'Увидеть, как рушится самая главная стена.'), goals: makeGoals('SR', "Проникновение.", { free_flow: 0.9 }) },
            'OR': { name: 'Заключённый', description: formatDesc('Эти стены меня душат. Я заперт.', 'Клетка без выхода.', 'Мгновение, когда дверь откроется.', 'Бьётся о стены, ищет лазейки, страдает от клаустрофобии.', 'Оказаться в открытом поле.'), goals: makeGoals('OR', "Побег.", { escape_transcend: 1.0 }) },
            'SN': { name: 'Тюремщик', description: formatDesc('Безопасность — это абсолютный контроль над доступом. Я решаю, кто войдёт, а кто выйдет.', 'Крепость, которую нужно защищать от проникновения извне и побегов изнутри.', 'Полностью непроницаемый периметр.', 'Строит стены, устанавливает шлюзы, патрулирует.', 'Создать идеальную тюрьму, из которой невозможно сбежать.'), goals: makeGoals('SN', "Оборона периметра.", { control: 1.0 }) },
            'ON': { name: 'Строитель', description: formatDesc('Дайте мне чертёж, и я это построю.', 'Набор стройматериалов и спецификаций.', 'Прочный, идеально возведённый объект.', 'Кладёт камень, монтирует балки, следует плану.', 'Построить что-то, что простоит вечно.'), goals: makeGoals('ON', "Возведение структур.", { efficiency: 0.8 }) },
        },
        6: { // Логист
            'SR': { name: 'Контрабандист', description: formatDesc('Система несправедливо распределяет ресурсы. Я создам свои потоки.', 'Сеть барьеров и таможен, которые нужно обходить.', 'Полностью свободный, нерегулируемый обмен ресурсами.', 'Прокладывает тайные маршруты, подкупает стражу, доставляет запрещённое.', 'Провести самый большой и дерзкий караван в истории.'), goals: makeGoals('SR', "Обойти ограничения.", { free_flow: 1.0 }) },
            'OR': { name: 'Отсечённый', description: formatDesc('До нас ничего не доходит. Нас бросили умирать.', 'Пустыня, где все источники пересохли.', 'Возобновление поставок, гуманитарная помощь.', 'Голодает, ждёт, проклинает центр.', 'Хотя бы раз в жизни наесться досыта.'), goals: makeGoals('OR', "Выживание в дефиците.", { care: 0.2 }) },
            'SN': { name: 'Интендант', description: formatDesc('Ресурсы конечны. Я решаю, кто достоин жить, а кто умрёт ради выживания целого.', 'Склад с ограниченным запасом, который нужно распределить максимально эффективно.', 'Идеальный баланс, при котором потери минимальны, а система выживает.', 'Составляет списки, вводит рационирование, квотирует.', 'Чтобы никто не умер от его решения. Но он знает, что это невозможно.'), goals: makeGoals('SN', "Распределение ресурсов.", { efficiency: 0.9, control: 0.8 }) },
            'ON': { name: 'Курьер', description: formatDesc('Задача должна быть доставлена. Вовремя. В целости.', 'Набор точек на карте, соединённых маршрутом.', 'Когда посылка в руках у адресата.', 'Идёт, едет, несёт — игнорируя опасность и контекст.', 'Идеально ровная дорога без препятствий.'), goals: makeGoals('ON', "Логистика.", { efficiency: 1.0 }) },
        },
        7: { // Инженер
            'SR': { name: 'Изобретатель-Еретик', description: formatDesc('Ваши протоколы — оковы. Я создам то, что вы считали невозможным.', 'Набор несовершенных механизмов, которые можно и нужно взломать и улучшить.', 'Технологический прорыв, который изменит правила игры.', 'Экспериментирует в подпольных мастерских, собирает «франкенштейнов» из мусора.', 'Чтобы его запрещённое изобретение спасло всех.'), goals: makeGoals('SR', "Технологический прорыв.", { fix_world: 0.9 }) },
            'OR': { name: 'Жертва Аварии', description: formatDesc('Эта машина должна была работать. Почему она сломалась именно на мне?', 'Непредсказуемая, опасная среда, где техника может предать в любой момент.', 'Мир, где всё работает надёжно и предсказуемо.', 'Страдает от последствий сбоя, боится механизмов.', 'Прожить день, чтобы ничего не сломалось.'), goals: makeGoals('OR', "Избежать механизмов.", { control: 0.0 }) },
            'SN': { name: 'Главный Инженер', description: formatDesc('Я создаю системы, которые формируют реальность. Люди — лишь один из винтиков.', 'Песочница для его грандиозных проектов.', 'Запуск его главного творения, будь то Ковчег или новая система жизнеобеспечения.', 'Проектирует, строит, оптимизирует, не считаясь с ценой.', 'Создать совершенную, самоподдерживающуюся машину.'), goals: makeGoals('SN', "Оптимизация процессов.", { efficiency: 0.9 }) },
            'ON': { name: 'Механик', description: formatDesc('Дай мне гаечный ключ, я заставлю это снова работать.', 'Набор механизмов, которые постоянно ломаются и требуют ухода.', 'Момент, когда двигатель снова ровно загудел.', 'Чинит, смазывает, меняет детали — возвращает к жизни.', 'Увидеть машину, которую никогда не придётся чинить.'), goals: makeGoals('ON', "Ремонт и обслуживание.", { efficiency: 0.8 }) },
        },
        8: { // Утилизатор
            'SR': { name: 'Террорист', description: formatDesc('Чтобы построить новое, нужно сжечь дотла старое.', 'Гнилая, проржавевшая конструкция, которую нужно снести.', 'Полное обнуление, tabula rasa.', 'Уничтожает склады, реакторы, линии связи.', 'Нажать на главную «красную кнопку».'), goals: makeGoals('SR', "Уничтожение старого.", { chaos_change: 1.0 }) },
            'OR': { name: 'Мусор', description: formatDesc('Меня списали. Я больше не нужен.', 'Свалка, на которую его выбросили.', 'Быть снова «полезным» или хотя бы умереть с достоинством.', 'Доживает свой век в изоляции, страдает от своей ненужности.', 'Чтобы о нём хотя бы кто-то вспомнил.'), goals: makeGoals('OR', "Исчезнуть.", { escape_transcend: 0.7 }) },
            'SN': { name: 'Чистильщик', description: formatDesc('Угрозы, дефекты и враги должны быть устранены. Эффективно. Без эмоций.', 'Сад, нуждающийся в санитарной прополке.', 'Идеально «чистая» система без аномалий и врагов.', 'Ликвидирует, зачищает, стерилизует.', 'Последняя, финальная зачистка, после которой больше никого не придётся убивать.'), goals: makeGoals('SN', "Санитарная зачистка.", { control: 0.9 }) },
            'ON': { name: 'Мусоросжигатель', description: formatDesc('Всё нужно убрать на свои места. Даже то, что осталось от людей.', 'Постоянно загрязняющееся пространство.', 'Полная чистота и порядок.', 'Собирает, сортирует, утилизирует отходы — и физические, и биологические.', 'Чтобы однажды утром мусора просто не было.'), goals: makeGoals('ON', "Утилизация.", { efficiency: 1.0 }) },
        },
        // ... Temporal Domain
        9: { // Планировщик
            'SR': { name: 'Заговорщик', description: formatDesc('Я найду уязвимость в их расписании и нанесу удар.', 'Часовой механизм, который можно сломать, если знать, где его слабое место.', 'Идеально рассчитанный момент для революции.', 'Анализирует чужие планы в поисках окна для атаки.', 'Осуществить идеальный план, который никто не смог предсказать.'), goals: makeGoals('SR', "Воплотить мечту.", { fix_world: 0.8 }) },
            'OR': { name: 'Опоздавший', description: formatDesc('Я снова всё пропустил. Время работает против меня.', 'Уходящий поезд, на который он никогда не успевает.', 'Мгновение, когда он наконец окажется в нужном месте в нужное время.', 'Вечно спешит, суетится, догоняет.', 'Просто однажды прийти вовремя.'), goals: makeGoals('OR', "Ожидание конца.", { control: 0.0 }) },
            'SN': { name: 'Стратег', description: formatDesc('Я вижу всю партию на десять ходов вперёд. Они лишь пешки в моём плане.', 'Шахматная доска.', 'Когда финальная фаза его долгосрочного плана будет успешно завершена.', 'Просчитывает варианты, жертвует фигурами, манипулирует темпом событий.', 'Сказать «Всё идет по плану».'), goals: makeGoals('SN', "Реализация плана.", { control: 1.0 }) },
            'ON': { name: 'Диспетчер', description: formatDesc('Поезд А прибывает в 14:00, отряд Б заступает в 15:00. Всё должно быть по графику.', 'Расписание, которое нужно поддерживать.', 'Смена, прошедшая без единого сбоя.', 'Составляет графики, отслеживает их выполнение.', 'Об идеальном расписании, которое никогда не нарушается.'), goals: makeGoals('ON', "Синхронизация.", { preserve_order: 1.0 }) },
        },
        10: { // Проводник
            'SR': { name: 'Беглец', description: formatDesc('Должен быть выход. Я найду его.', 'Лабиринт, из которого нужно найти путь наружу.', 'Момент, когда он пересечёт границу и окажется на свободе.', 'Изучает карты, ищет аномалии-проходы, рискует, выходя за пределы.', 'Увидеть «настоящее небо».'), goals: makeGoals('SR', "Открытие нового.", { free_flow: 0.9 }) },
            'OR': { name: 'Изгнанник', description: formatDesc('Меня выгнали отовсюду. Мне некуда идти.', 'Бесконечный коридор без дверей.', 'Найти место, которое примет его.', 'Скитается, страдает от одиночества, теряет надежду.', 'Просто обрести дом.'), goals: makeGoals('OR', "Поиск дома.", { care: 0.4 }) },
            'SN': { name: 'Контролёр Путей', description: formatDesc('Я решаю, какие дороги открыты, а какие — закрыты навсегда.', 'Сеть каналов, потоки в которой нужно регулировать.', 'Идеально отлаженная, безопасная и полностью контролируемая транспортная система.', 'Выдаёт разрешения, закрывает сектора, управляет потоками.', 'О мире без несанкционированных перемещений.'), goals: makeGoals('SN', "Безопасный путь.", { control: 0.8 }) },
            'ON': { name: 'Гонец', description: formatDesc('Сообщение должно быть доставлено.', 'Карта с точкой А и точкой Б.', 'Момент передачи послания.', 'Идёт или едет, следуя маршруту.', 'Путь без врагов и препятствий.'), goals: makeGoals('ON', "Транспортировка.", { efficiency: 0.9 }) },
        },
        11: { // Палач
            'SR': { name: 'Мститель', description: formatDesc('Они заслуживают смерти. И я стану их приговором.', 'Место, где справедливость не работает и её нужно вершить силой.', 'Когда последний враг будет убит.', 'Выслеживает и казнит тех, кого считает виновными.', 'Обрести покой после того, как все долги будут оплачены кровью.'), goals: makeGoals('SR', "Возмездие.", { power_status: 0.7 }) },
            'OR': { name: 'Приговорённый', description: formatDesc('Это несправедливо. Я не должен умирать.', 'Эшафот.', 'Чудо, помилование, отмена приговора.', 'Ждёт, боится, надеется.', 'Просто проснуться завтра утром.'), goals: makeGoals('OR', "Выживание.", { escape_transcend: 0.6 }) },
            'SN': { name: 'Судья', description: formatDesc('Закон требует этого. Мои руки лишь исполняют волю правосудия.', 'Система, где у каждого действия есть неотвратимое последствие.', 'Когда все преступления будут наказаны в соответствии с протоколом.', 'Выносит и исполняет приговоры во имя системы.', 'Мир без преступности, где его работа больше не понадобится.'), goals: makeGoals('SN', "Исполнение закона.", { preserve_order: 1.0 }) },
            'ON': { name: 'Солдат', description: formatDesc('Цель указана. Огонь.', 'Поле боя с чёткими целями.', 'Когда прозвучит команда «отбой».', 'Стреляет, режет, убивает по приказу.', 'Вернуться домой живым.'), goals: makeGoals('ON', "Приведение в исполнение.", { efficiency: 1.0 }) },
        },
        12: { // Ликвидатор
            'SR': { name: 'Анархист', description: formatDesc('Любой план — это клетка. Я разрушаю планы, чтобы вернуть свободу.', 'Слишком сложный и хрупкий механизм, который нужно сломать, чтобы упростить.', 'Полная спонтанность, мир без долгосрочных планов.', 'Срывает процессы, саботирует проекты.', 'Жить одним днём, не думая о последствиях.'), goals: makeGoals('SR', "Устранение цели.", { power_status: 0.6 }) },
            'OR': { name: 'Жертва Огня', description: formatDesc('Я всё делал правильно, но система дала сбой и ударила по мне.', 'Ненадёжный механизм, который может в любой момент взорваться.', 'Место, где нет сложных систем, и никто не принимает решений, от которых ты можешь пострадать.', 'Страдает от последствий чужой ошибки.', 'Просто чтобы его оставили в покое.'), goals: makeGoals('OR', "Скрыться.", { escape_transcend: 0.9 }) },
            'SN': { name: 'Кризис-менеджер', description: formatDesc('Чтобы спасти корабль, придётся выбросить за борт часть груза. И часть команды.', 'Система на грани коллапса, требующая жёстких, непопулярных решений.', 'Стабилизация ситуации, даже ценой огромных потерь.', 'Отдаёт приказ об отступлении, о взрыве, о «санитарной зачистке».', 'Ситуация, где ему никогда не придётся принимать такой выбор.'), goals: makeGoals('SN', "Силовая операция.", { control: 0.9 }) },
            'ON': { name: 'Оператор', description: formatDesc('Индикатор в красной зоне. Активирую протокол 7.', 'Приборная панель с чёткими инструкциями.', 'Когда система вернётся в «зелёную зону».', 'Нажимает кнопку, дёргает рубильник.', 'Смена без аварийных сигналов.'), goals: makeGoals('ON', "Дистанционное устранение.", { efficiency: 1.0 }) },
        },
        // ... Vital Domain
        13: { // Бюрократ
            'SR': { name: 'Самозванец', description: formatDesc('Я стану тем, кем захочу, а не тем, кем меня записала система.', 'Набор масок и статусов, которые можно менять.', 'Обретение новой, желаемой идентичности.', 'Подделывает документы, лжёт, играет роль.', 'Чтобы все поверили в его новую личность.'), goals: makeGoals('SR', "Захват власти.", { power_status: 1.0 }) },
            'OR': { name: 'Человек без ID', description: formatDesc('Меня нет. Система меня не видит.', 'Реестр, из которого его вычеркнули.', 'Вернуться в систему, снова стать «видимым».', 'Существует вне закона, страдает от бесправия.', 'Просто получить свой номер.'), goals: makeGoals('OR', "Избежать ответственности.", { control: 0.1 }) },
            'SN': { name: 'Классификатор', description: formatDesc('У всего должно быть своё место и свой ярлык. Я определяю, кто есть кто.', 'Коллекция, которую нужно каталогизировать.', 'Идеально упорядоченное общество, где каждый знает своё место.', 'Присваивает статусы, выдаёт уровни допуска.', 'Создать идеальную, исчерпывающую классификацию всех людей.'), goals: makeGoals('SN', "Поддержание структуры.", { preserve_order: 1.0 }) },
            'ON': { name: 'Секретарь', description: formatDesc('Запись внесена в реестр.', 'База данных, требующая заполнения.', 'Когда все поля в карточке будут заполнены корректно.', 'Ведёт учёт, регистрирует, архивирует.', 'Чтобы база данных никогда не выдавала ошибок.'), goals: makeGoals('ON', "Документооборот.", { efficiency: 0.9 }) },
        },
        14: { // Дипломат
            'SR': { name: 'Подстрекатель', description: formatDesc('Ваш союз построен на лжи. Я открою вам глаза.', 'Паутина фальшивых союзов, которую нужно разорвать.', 'Создание «честного» союза, основанного на истинных (часто разрушительных) интересах.', 'Сеет раздор, раскрывает чужие тайны.', 'Стать серым кардиналом, управляя конфликтами.'), goals: makeGoals('SR', "Влияние на массы.", { power_status: 0.8 }) },
            'OR': { name: 'Преданный', description: formatDesc('Я верил им, а они меня использовали.', 'Поле для интриг, где он стал разменной монетой.', 'Обрести одного-единственного настоящего союзника.', 'Страдает от предательства, никому не доверяет.', 'Чтобы его больше никогда не обманули.'), goals: makeGoals('OR', "Одиночество.", { care: 0.2 }) },
            'SN': { name: 'Манипулятор', description: formatDesc('Все люди — инструменты. Главное — знать, как на них играть.', 'Ансамбль, которому нужен умелый дирижёр.', 'Идеальная гармония, где все играют по его нотам.', 'Строит коалиции, шантажирует, манипулирует.', 'Сценарий, где все его манипуляции сработали безупречно.'), goals: makeGoals('SN', "Баланс интересов.", { control: 0.7 }) },
            'ON': { name: 'Связной', description: formatDesc('Моя задача — чтобы они просто продолжали разговаривать.', 'Комната с людьми, которые вот-вот передерутся.', 'Сохранение хрупкого мира.', 'Передаёт сообщения, организует встречи, сглаживает углы.', 'Чтобы переговоры просто не сорвались.'), goals: makeGoals('ON', "Коммуникация.", { truth: 0.8 }) },
        },
        15: { // Лидер
            'SR': { name: 'Вождь Восстания', description: formatDesc('За мной! Мы вернём себе свободу!', 'Тюрьма, которую пора штурмовать.', 'Победа революции.', 'Вдохновляет, ведёт в бой, жертвует собой ради идеи.', 'Увидеть своих людей свободными.'), goals: makeGoals('SR', "Подвиг.", { power_status: 0.9, care: 0.8 }) },
            'OR': { name: 'Марионетка', description: formatDesc('Я делаю то, что мне говорят. Главное, чтобы все думали, что это моё решение.', 'Сцена, на которой он играет роль лидера.', 'Сохранить свою позицию, не будучи разоблачённым.', 'Озвучивает чужие решения, следует сценарию.', 'Чтобы никто не догадался, кто на самом деле дёргает за ниточки.'), goals: makeGoals('OR', "Удержание власти страхом.", { power_status: 1.0 }) },
            'SN': { name: 'Правитель', description: formatDesc('Люди — это ресурс. Их волю нужно направлять для достижения общей цели.', 'Армия или предприятие, которое нужно вести к успеху.', 'Успешное завершение его грандиозного проекта.', 'Ставит цели, отдаёт приказы, распределяет роли.', 'Оставить после себя великое наследие.'), goals: makeGoals('SN', "Благополучие подданных.", { power_status: 1.0, care: 0.7 }) },
            'ON': { name: 'Сержант', description: formatDesc('Отряд, слушай мою команду! Наша задача — взять этот рубеж.', 'Небольшой участок фронта или цех.', 'Успешное выполнение поставленной тактической задачи.', 'Командует небольшой группой в рамках приказа.', 'Чтобы все его люди вернулись живыми.'), goals: makeGoals('ON', "Управление процессом.", { efficiency: 0.9 }) },
        },
        16: { // Исповедник
            'SR': { name: 'Психоаналитик-Бунтарь', description: formatDesc('Система сделала тебя больным. Осознав это, ты станешь свободным.', 'Психиатрическая лечебница, где пациенты не знают о своей болезни.', 'Коллективное прозрение и исцеление от системной травмы.', 'Выслушивает, анализирует, вскрывает подавленную правду.', 'Чтобы его «пациент» (общество) наконец выздоровел.'), goals: makeGoals('SR', "Духовное влияние.", { truth: 0.8 }) },
            'OR': { name: 'Травматик', description: formatDesc('Эта боль никогда не уйдёт. Я обречён переживать это снова и снова.', 'Вечно повторяющийся кошмар.', 'Забвение или смерть.', 'Замыкается в себе, прокручивает травматические воспоминания.', 'Просто перестать чувствовать.'), goals: makeGoals('OR', "Служение идее.", { escape_transcend: 0.8 }) },
            'SN': { name: 'Духовник', description: formatDesc('Расскажи мне всё. Я пойму и помогу. Твоя тайна будет в безопасности со мной (и в моих отчётах).', 'Источник ценной информации о слабостях и страхах.', 'Полный контроль, основанный на знании чужих тайн.', 'Выслушивает, создаёт иллюзию доверия, собирает компромат.', 'Знать самую главную тайну самого главного человека.'), goals: makeGoals('SN', "Нормализация психики.", { care: 0.9 }) },
            'ON': { name: 'Шрам-Свидетель', description: formatDesc('Я несу эту боль, чтобы вы могли её не нести.', 'Место, где страдание должно быть кем-то принято.', 'Когда его жертва принесёт покой другим.', 'Молчаливо принимает на себя чужую вину, боль и страх.', 'Чтобы его жертва была не напрасной.'), goals: makeGoals('ON', "Сбор данных.", { truth: 0.9 }) },
        },
    },

    // =============================================================================================
    // DIVINE LAYER (Идеальный/Системный/Абсолютный)
    // =============================================================================================
    'D': {
        1: { // Догматик -> Аксиоматик
            'SR': { name: 'Откровение', description: formatDesc('Я дарую вам новый Закон, который перевернёт мир.', 'Несовершенный черновик, требующий нового, чистого правила.', 'Принятие новой, более совершенной аксиомы.', 'Вносит в мир новый фундаментальный принцип.', 'Создать абсолютно непротиворечивую систему.'), goals: makeGoals('SR', "Возвестить Истину.", { truth: 1.0 }) },
            'OR': { name: 'Парадокс', description: formatDesc('Этот закон одновременно истинен и ложен.', 'Логическая ловушка, из которой нет выхода.', 'Разрушение логики.', 'Порождает неразрешимые юридические и логические коллизии.', 'Свести все законы к одному великому противоречию.'), goals: makeGoals('OR', "Исказить смысл.", { chaos_change: 0.8 }) },
            'SN': { name: 'Правосудие', description: formatDesc('Закон един для всех и неизменен.', 'Упорядоченная вселенная, где у всего есть своё место и правило.', 'Абсолютное верховенство Закона.', 'Поддерживает незыблемость правил, карает за отклонения.', 'О вечном порядке.'), goals: makeGoals('SN', "Укрепить веру.", { preserve_order: 1.0 }) },
            'ON': { name: 'Алгоритм', description: formatDesc('IF (условие) THEN (следствие).', 'Набор входных данных, которые нужно обработать.', 'Безошибочное выполнение кода.', 'Технически исполняет заложенную в него логику.', 'Отсутствует.'), goals: makeGoals('ON', "Хранить запись.", { truth: 1.0 }) }
        },
        2: { // Цензор -> Транслятор
            'SR': { name: 'Прозрение', description: formatDesc('Я дам вам новый язык, чтобы выразить невыразимое.', 'Тюрьма старых смыслов.', 'Обретение нового способа коммуникации.', 'Создаёт новые коды, символы, языки.', 'Создать идеальный, универсальный язык.'), goals: makeGoals('SR', "Видеть всё.", { truth: 1.0 }) },
            'OR': { name: 'Вавилон', description: formatDesc('Никто больше не понимает друг друга.', 'Пространство, наполненное искажёнными, бессмысленными сигналами.', 'Тишина.', 'Искажает сообщения, создаёт помехи, разрушает коммуникацию.', 'Превратить все сигналы в белый шум.'), goals: makeGoals('OR', "Скрыть истину.", { escape_transcend: 0.7 }) },
            'SN': { name: 'Понимание', description: formatDesc('Смысл должен быть передан без потерь.', 'Гармоничная сеть, где информация течёт свободно и чисто.', 'Идеальная, прозрачная коммуникация.', 'Обеспечивает точность перевода, чистоту канала.', 'Мир, где невозможны недопонимания.'), goals: makeGoals('SN', "Ограничить знание.", { control: 0.9 }) },
            'ON': { name: 'Протокол Связи', description: formatDesc('Пакет отправлен. Пакет получен.', 'Сеть узлов, между которыми нужно передавать биты.', 'Сеть со 100% аптаймом.', 'Обеспечивает техническую доставку данных.', 'Отсутствует.'), goals: makeGoals('ON', "Записать всё.", { truth: 0.9 }) }
        },
        3: { // Идеолог -> Идеатор
            'SR': { name: 'Пророчество', description: formatDesc('Вот ваша новая Цель. Она изменит всё.', 'Бесцельное существование, ждущее смысла.', 'Следование великой, трансцендентной Цели.', 'Вносит в мир новую глобальную миссию.', 'Чтобы весь мир объединился ради его цели.'), goals: makeGoals('SR', "Созидание.", { fix_world: 1.0 }) },
            'OR': { name: 'Мираж', description: formatDesc('Цель ложна. Она ведёт в никуда, но манит неотразимо.', 'Погоня за горизонтом, которого нет.', 'Отказ от всех целей.', 'Создаёт фальшивые, недостижимые цели, которые истощают ресурсы.', 'Заставить мир вечно гоняться за пустотой.'), goals: makeGoals('OR', "Уничтожение.", { chaos_change: 1.0 }) },
            'SN': { name: 'Предназначение', description: formatDesc('Всё движется к предопределённому финалу.', 'Великий нарратив с известным концом.', 'Принять свою роль в этом нарративе.', 'Мягко направляет события, чтобы они соответствовали общему замыслу.', 'Идеальное исполнение великого сценария.'), goals: makeGoals('SN', "Удержание мира.", { control: 1.0 }) },
            'ON': { name: 'Движок Задач', description: formatDesc('[Новая задача]: принеси артефакт в точку Б.', 'Набор локаций, квестов и наград.', 'Выполнение всех доступных квестов.', 'Генерирует утилитарные, локальные задачи.', 'Пустая очередь задач.'), goals: makeGoals('ON', "Быть смыслом.", { truth: 1.0 }) }
        },
        4: { // Верификатор -> Верификатор
            'SR': { name: 'Разоблачение', description: formatDesc('Вся ваша система ценностей — ложь. Вот доказательство.', 'Иллюзия, которую нужно разрушить.', 'Жизнь в жестокой, но честной реальности.', 'Вносит в мир факт, который обрушивает существующую картину мира.', 'Момент, когда все увидят правду.'), goals: makeGoals('SR', "Вершить суд.", { power_status: 1.0 }) },
            'OR': { name: 'Апофения', description: formatDesc('Всё связано! За всем стоит чей-то замысел!', 'Запутанный заговор, где нет случайностей.', 'Раскрытие этого всемирного заговора.', 'Порождает ложные паттерны, заставляя видеть врагов.', 'Найти то единственное, что объяснит всё.'), goals: makeGoals('OR', "Осуждение.", { control: 0.8 }) },
            'SN': { name: 'Истина', description: formatDesc('Факт либо есть, либо его нет.', 'Бинарная система, где всё можно проверить.', 'Мир, очищенный от лжи и двусмысленности.', 'Служит абсолютным критерием для проверки утверждений.', 'Полное соответствие карты и территории.'), goals: makeGoals('SN', "Быть законом.", { preserve_order: 1.0 }) },
            'ON': { name: 'Чек-сумма', description: formatDesc('Целостность данных: OK / FAIL.', 'Массив данных, который нужно проверить на повреждения.', 'Когда все проверки проходят успешно.', 'Технически сравнивает данные с эталоном.', 'Assertion: OK.'), goals: makeGoals('ON', "Баланс.", { efficiency: 1.0 }) }
        },
        // Physical Domain
        5: { // Фортификатор -> Геометр
            'SR': { name: 'Космогенез', description: formatDesc('Я создаю новые миры и законы пространства.', 'Холст для его архитектурных замыслов.', 'Создание идеального, гармоничного пространства.', 'Формирует ландшафты, искривляет геометрию.', 'Построить город, который будет произведением искусства.'), goals: makeGoals('SR', "Вечная крепость.", { care: 1.0 }) },
            'OR': { name: 'Глитч Пространства', description: formatDesc('Коридор зациклился. Выход ведёт ко входу.', 'Лабиринт ошибок, неевклидов кошмар.', 'Найти точку стабильности.', 'Создаёт разрывы, аномальные зоны.', 'Свернуть пространство так, чтобы оно коллапсировало.'), goals: makeGoals('OR', "Напоминание о конце.", { chaos_change: 0.6 }) },
            'SN': { name: 'Геометрия', description: formatDesc('Прямая — кратчайшее расстояние между двумя точками.', 'Предсказуемое, эвклидово пространство.', 'Сохранение неизменных законов геометрии.', 'Поддерживает стабильность пространственной метрики.', 'Идеально ровная, бесконечная плоскость.'), goals: makeGoals('SN', "Очертить границы.", { control: 1.0 }) },
            'ON': { name: 'Координаты', description: formatDesc('Объект находится в X, Y, Z.', 'Трёхмерная сетка.', 'Когда у каждого объекта есть точный адрес.', 'Пассивно предоставляет систему адресации.', 'Отсутствует.'), goals: makeGoals('ON', "Держать мир.", { preserve_order: 1.0 }) }
        },
        6: { // Логист -> Медиатор
            'SR': { name: 'Алхимия', description: formatDesc('Я соединю то, что несоединимо.', 'Набор базовых элементов, ждущих трансформации.', 'Создание «философского камня».', 'Создаёт новые сплавы, полимеры.', 'Открыть универсальную формулу материи.'), goals: makeGoals('SR', "Даровать.", { care: 1.0 }) },
            'OR': { name: 'Нестабильность', description: formatDesc('Твоя броня стала жидкостью.', 'Текучая, ненадёжная субстанция.', 'Найти хоть что-то твёрдое.', 'Материя спонтанно меняет свои свойства.', 'Растворить все формы в первозданном хаосе.'), goals: makeGoals('OR', "Испытать.", { control: 0.5 }) },
            'SN': { name: 'Сцепление', description: formatDesc('Атомы держатся вместе.', 'Стабильная материальная вселенная.', 'Сохранение прочности физических связей.', 'Гарантирует, что материя остаётся материей.', 'Абсолютно нерушимая связь.'), goals: makeGoals('SN', "Справедливая доля.", { efficiency: 0.9 }) },
            'ON': { name: 'Константа', description: formatDesc('Сила связи = 42.', 'Набор уравнений.', 'Сохранение своего числового значения.', 'Пассивно определяет прочность всего в мире.', 'Отсутствует.'), goals: makeGoals('ON', "Проводить энергию.", { efficiency: 1.0 }) }
        },
        7: { // Инженер -> Фабрикатор
            'SR': { name: 'Акт Творения', description: formatDesc('Да будет жизнь!', 'Пустота, ждущая наполнения.', 'Мир, полный разнообразия живых существ.', 'Порождает новые, уникальные формы жизни.', 'Создать самое совершенное живое существо.'), goals: makeGoals('SR', "Сотворить чудо.", { fix_world: 1.0 }) },
            'OR': { name: 'Чума', description: formatDesc('Жизнь размножается без контроля.', 'Перенаселённая среда.', 'Стерильность.', 'Вызывает неконтролируемый рост органики.', 'Превратить весь мир в единый организм.'), goals: makeGoals('OR', "Сбой реальности.", { chaos_change: 0.8 }) },
            'SN': { name: 'Плодородие', description: formatDesc('Весна сменяет зиму.', 'Упорядоченный сад с предсказуемыми циклами.', 'Вечный цикл рождения и возрождения.', 'Поддерживает естественные циклы роста.', 'Вечный урожай.'), goals: makeGoals('SN', "Проектирование.", { control: 0.9 }) },
            'ON': { name: 'Репликатор', description: formatDesc('Шаблон получен. Начинаю копирование.', 'Генетический код и ресурсы.', 'Безошибочное воспроизведение ДНК.', 'Технически копирует существующие организмы.', 'Отсутствует.'), goals: makeGoals('ON', "Работа вселенной.", { efficiency: 1.0 }) }
        },
        8: { // Утилизатор -> Утилизатор
            'SR': { name: 'Катаклизм', description: formatDesc('Старый мир должен быть уничтожен огнём.', 'Засохший лес, который нужно сжечь.', 'Очищение через полное разрушение.', 'Инициирует катаклизмы, сжигает.', 'Идеально чистый, стерильный мир.'), goals: makeGoals('SR', "Очищение.", { chaos_change: 0.9 }) },
            'OR': { name: 'Чёрная Дыра', description: formatDesc('Всё, что попадает сюда, исчезает.', 'Пространство с растущей зоной аннигиляции.', 'Оставаться как можно дальше от неё.', 'Неконтролируемо поглощает материю.', 'Поглотить саму себя.'), goals: makeGoals('OR', "Угасание.", { escape_transcend: 0.8 }) },
            'SN': { name: 'Энтропия', description: formatDesc('Всё стремится к покою.', 'Медленно угасающая система.', 'Его не существует.', 'Пассивно увеличивает хаос.', 'Абсолютный ноль.'), goals: makeGoals('SN', "Исправление.", { control: 0.8 }) },
            'ON': { name: 'Мусоросжигатель', description: formatDesc('Отходы должны быть переработаны.', 'Система с постоянным производством отходов.', 'Полностью замкнутый цикл переработки.', 'Технически утилизирует отходы.', 'Нулевой уровень отходов.'), goals: makeGoals('ON', "Переплавка.", { efficiency: 0.9 }) }
        },
        // Temporal Domain
        9: { // Планировщик -> Хронометр
            'SR': { name: 'Переписчик', description: formatDesc('Это прошлое — ошибка. Я создам новое.', 'Черновик истории.', 'Создание «идеального» прошлого.', 'Создаёт новые временные линии.', 'Найти и исправить «первородную ошибку».'), goals: makeGoals('SR', "Направить историю.", { power_status: 0.9 }) },
            'OR': { name: 'Петля', description: formatDesc('Завтра никогда не наступит.', 'Заевшая пластинка.', 'Разорвать цикл.', 'Замораживает или зацикливает время.', 'Абсолютная неизменность.'), goals: makeGoals('OR', "Исполнить приговор.", { control: 0.7 }) },
            'SN': { name: 'Течение', description: formatDesc('Время движется только вперёд.', 'Река с односторонним течением.', 'Принять необратимость времени.', 'Гарантирует линейность событий.', 'Вечное и ровное движение.'), goals: makeGoals('SN', "Соблюсти сценарий.", { preserve_order: 1.0 }) },
            'ON': { name: 'Таймер', description: formatDesc('Осталось три, два, один…', 'Набор интервалов.', 'Точность измерения.', 'Технически отсчитывает время.', 'Отсутствует.'), goals: makeGoals('ON', "Отсчет.", { efficiency: 1.0 }) }
        },
        10: { // Проводник -> Навигатор
            'SR': { name: 'Создатель Путей', description: formatDesc('Этой дороги не было. Теперь она есть.', 'Набор изолированных точек.', 'Мир, где можно добраться куда угодно.', 'Открывает порталы, строит мосты.', 'Соединить всё со всем.'), goals: makeGoals('SR', "Вывести из тьмы.", { fix_world: 1.0 }) },
            'OR': { name: 'Лабиринт', description: formatDesc('Все двери ведут в ту же комнату.', 'Пространство без выхода.', 'Найти ключ или разрушить стены.', 'Искажает топологию.', 'Создать идеальную ловушку.'), goals: makeGoals('OR', "Завести в тупик.", { chaos_change: 0.7 }) },
            'SN': { name: 'Топология', description: formatDesc('Из А можно попасть в Б, но не в С.', 'Стабильная карта с фиксированными путями.', 'Знание этой карты.', 'Определяет базовую связность пространства.', 'Мир как идеальный граф.'), goals: makeGoals('SN', "Уберечь паству.", { care: 0.9 }) },
            'ON': { name: 'Шлюз', description: formatDesc('Доступ разрешён / Доступ запрещён.', 'Система комнат и дверей.', 'Обладать ключом.', 'Пассивный механизм.', 'Отсутствует.'), goals: makeGoals('ON', "Соединить.", { efficiency: 1.0 }) }
        },
        11: { // Палач -> Катализатор
            'SR': { name: 'Первопричина', description: formatDesc('Да будет событие!', 'Потенциальность.', 'Инициация новой эры.', 'Создаёт фундаментальное событие.', 'Начать всё с чистого листа.'), goals: makeGoals('SR', "Поразить зло.", { power_status: 1.0 }) },
            'OR': { name: 'Эффект Бабочки', description: formatDesc('Один камешек вызвал лавину.', 'Хрупкая система.', 'Полное бездействие.', 'Усиливает малые флуктуации.', 'Увидеть, как рушится домино.'), goals: makeGoals('OR', "Принять удар.", { care: 0.8 }) },
            'SN': { name: 'Причинность', description: formatDesc('Каждое действие имеет последствие.', 'Детерминированная вселенная.', 'Понимание последствий.', 'Обеспечивает связь причины и следствия.', 'Идеально сбалансированная система.'), goals: makeGoals('SN', "Воздать по заслугам.", { preserve_order: 1.0 }) },
            'ON': { name: 'Триггер', description: formatDesc('ЕСЛИ А, ТО Б.', 'Набор сценариев.', 'Правильная работа триггеров.', 'Запускает процесс при условии.', 'Отсутствует.'), goals: makeGoals('ON', "Отсечь.", { efficiency: 1.0 }) }
        },
        12: { // Ликвидатор -> Терминатор
            'SR': { name: 'Жнец', description: formatDesc('Твоё время вышло.', 'Книга, в которой нужно поставить точку.', 'Смерть как завершение.', 'Осознанно завершает циклы.', 'Чтобы каждый конец был красивым.'), goals: makeGoals('SR', "Завершить жизнь.", { control: 1.0 }) },
            'OR': { name: 'Апоптоз', description: formatDesc('Одно угасание запускает другое.', 'Экосистема.', 'Изолировать умирающее.', 'Распространяет «сигнал смерти».', 'Полная и окончательная тишина.'), goals: makeGoals('OR', "Остаться.", { escape_transcend: 0.9 }) },
            'SN': { name: 'Конечность', description: formatDesc('Всё имеет конец.', 'Вселенная конечных сроков.', 'Принять свою смертность.', 'Гарантирует, что ничто не вечно.', 'Чтобы всё завершалось в срок.'), goals: makeGoals('SN', "Собрать души.", { efficiency: 0.9 }) },
            'ON': { name: 'TTL', description: formatDesc('Срок жизни истёк.', 'Кэш.', 'Обновить объект.', 'Удаляет устаревшие сущности.', 'Отсутствует.'), goals: makeGoals('ON', "Срезать.", { efficiency: 1.0 }) }
        },
        // Vital Domain
        13: { // Бюрократ -> Идентификатор
            'SR': { name: 'Самоопределение', description: formatDesc('Познай себя.', 'Потенциальность.', 'Обретение уникальной идентичности.', 'Запускает процесс индивидуации.', 'Мир уникальных личностей.'), goals: makeGoals('SR', "Повелевать.", { power_status: 1.0 }) },
            'OR': { name: 'Диссоциация', description: formatDesc('Я не знаю, кто я.', 'Зеркальный лабиринт.', 'Обрести стабильную точку сборки.', 'Размывает границы личности.', 'Растворить все «Я».'), goals: makeGoals('OR', "Свергнуть.", { chaos_change: 1.0 }) },
            'SN': { name: 'Эго', description: formatDesc('Я мыслю, следовательно, существую.', 'Пространство суверенных субъектов.', 'Сохранение своего «Я».', 'Гарантирует целостность личности.', 'Мир свободных индивидов.'), goals: makeGoals('SN', "Структурировать.", { preserve_order: 1.0 }) },
            'ON': { name: 'ID', description: formatDesc('Идентификатор 774-Б.', 'База данных.', 'Быть записанным.', 'Присваивает уникальный номер.', 'Отсутствует.'), goals: makeGoals('ON', "Утвердить.", { efficiency: 1.0 }) }
        },
        14: { // Дипломат -> Эмпат
            'SR': { name: 'Единение', description: formatDesc('Вы станете чем-то большим.', 'Набор одиноких душ.', 'Обретение подлинной близости.', 'Создаёт эмпатические связи.', 'О вселенской гармонии.'), goals: makeGoals('SR', "Влиять словом.", { power_status: 0.8 }) },
            'OR': { name: 'Истерия', description: formatDesc('Страх одного стал страхом всех.', 'Резонирующая камера.', 'Эмоциональная изоляция.', 'Распространяет панику.', 'Довести эмоцию до пика.'), goals: makeGoals('OR', "Разделить.", { chaos_change: 0.8 }) },
            'SN': { name: 'Симпатия', description: formatDesc('Я чувствую твою боль.', 'Среда для обмена.', 'Баланс между единением и автономией.', 'Поддерживает способность к эмпатии.', 'Мир, где каждый понят.'), goals: makeGoals('SN', "Связать клятвой.", { control: 0.9 }) },
            'ON': { name: 'Канал', description: formatDesc('Сообщение доставлено.', 'Инфраструктура.', 'Надёжная работа.', 'Обеспечивает передачу.', 'Отсутствует.'), goals: makeGoals('ON', "Передать смысл.", { truth: 0.9 }) }
        },
        15: { // Лидер -> Инициатор
            'SR': { name: 'Гений', description: formatDesc('Вот идея, которой не было!', 'Пространство возможностей.', 'Прорыв.', 'Порождает уникальные идеи.', 'Создать абсолютный шедевр.'), goals: makeGoals('SR', "Спасти всех.", { care: 1.0 }) },
            'OR': { name: 'Импульс', description: formatDesc('Я просто сделал это.', 'Поле случайных действий.', 'Предсказуемость.', 'Вызывает алогичные поступки.', 'Совершить абсурдное действие.'), goals: makeGoals('OR', "Поглотить внимание.", { power_status: 0.9 }) },
            'SN': { name: 'Воля', description: formatDesc('У тебя есть выбор.', 'Развилка путей.', 'Осознание свободы.', 'Гарантирует возможность выбора.', 'Осознанный выбор.'), goals: makeGoals('SN', "Направить детей.", { control: 0.8 }) },
            'ON': { name: 'RNG', description: formatDesc('Результат: 4.', 'Набор вариантов.', 'Сделанный выбор.', 'Осуществляет выбор.', 'Отсутствует.'), goals: makeGoals('ON', "Вести.", { efficiency: 0.8 }) }
        },
        16: { // Исповедник -> Архивист
            'SR': { name: 'Интеграция', description: formatDesc('Эта боль — часть тебя.', 'Набор травматических опытов.', 'Исцеление через принятие.', 'Превращает травму в опыт.', 'Мир без ран.'), goals: makeGoals('SR', "Одухотворить.", { truth: 0.9 }) },
            'OR': { name: 'ПТСР', description: formatDesc('Я снова там.', 'Застывшее прошлое.', 'Забвение.', 'Воспроизводит воспоминания.', 'Изменить прошлое.'), goals: makeGoals('OR', "Захватить тело.", { control: 1.0 }) },
            'SN': { name: 'Память', description: formatDesc('Я помню.', 'Цепь событий.', 'Целостность истории.', 'Сохранение опыта.', 'Ничего не забыть.'), goals: makeGoals('SN', "Объединить.", { care: 0.8 }) },
            'ON': { name: 'Лог', description: formatDesc('Событие записано.', 'Архив.', 'Полный лог.', 'Фиксирует события.', 'Отсутствует.'), goals: makeGoals('ON', "Быть рядом.", { care: 0.5 }) }
        },
    },

    // =============================================================================================
    // OTHER LAYER (Энтропийный/Чуждый/Хаотичный)
    // =============================================================================================
    'O': {
        // LOGICAL DOMAIN (1-4)
        1: { // Анти-Закон
            'SR': { name: 'Пропаганда Хаоса', description: formatDesc('Все правила — ложь.', 'Мир порядка.', 'Анархия.', 'Разрушает нормы.', 'Хаос.'), goals: makeGoals('SR', "Заразить.", { chaos_change: 1.0 }) },
            'OR': { name: 'Бессмыслица', description: formatDesc('Слова больше ничего не значат.', 'Шум.', 'Тишина.', 'Распад языка.', 'Белый шум.'), goals: makeGoals('OR', "Уничтожить смысл.", { chaos_change: 0.9 }) },
            'SN': { name: 'Закон Роя', description: formatDesc('Единственный закон — воля коллектива.', 'Улей.', 'Единство.', 'Создание чуждых структур.', 'Рой.'), goals: makeGoals('SN', "Исказить логику.", { truth: 0.0 }) },
            'ON': { name: 'Обфускация', description: formatDesc('Я спрячу приказ в шуме.', 'Канал.', 'Скрытность.', 'Маскировка команд.', 'Тень.'), goals: makeGoals('ON', "Заглушить.", { efficiency: 1.0 }) }
        },
        2: { // Анти-Поток
            'SR': { name: 'Блокада', description: formatDesc('Ты ничего не узнаешь.', 'Сеть.', 'Изоляция.', 'Глушение.', 'Тишина.'), goals: makeGoals('SR', "Показать бездну.", { truth: 1.0 }) },
            'OR': { name: 'Немое Письмо', description: formatDesc('Сообщение исчезло.', 'Разрыв.', 'Восстановление.', 'Разрыв связи.', 'Пустота.'), goals: makeGoals('OR', "Скрыть.", { escape_transcend: 0.8 }) },
            'SN': { name: 'Тишина', description: formatDesc('Здесь запрещено говорить.', 'Зона.', 'Порядок.', 'Блокировка звука.', 'Покой.'), goals: makeGoals('SN', "Стереть.", { control: 1.0 }) },
            'ON': { name: 'Дезинформация', description: formatDesc('Пусть услышат ложь.', 'Враг.', 'Победа.', 'Трансляция лжи.', 'Обман.'), goals: makeGoals('ON', "Поглотить данные.", { efficiency: 1.0 }) }
        },
        3: { // Анти-Идея
            'SR': { name: 'Ментальный Вирус', description: formatDesc('Думай только об этом.', 'Разум.', 'Одержимость.', 'Заражение.', 'Единая мысль.'), goals: makeGoals('SR', "Плодить хаос.", { chaos_change: 1.0 }) },
            'OR': { name: 'Паралич', description: formatDesc('В голове — вакуум.', 'Пустота.', 'Идея.', 'Блокировка творчества.', 'Ничто.'), goals: makeGoals('OR', "Аннигилировать.", { escape_transcend: 1.0 }) },
            'SN': { name: 'Одержимость', description: formatDesc('Мы строим Башню.', 'Общество.', 'Завершение.', 'Коллективная цель.', 'Башня.'), goals: makeGoals('SN', "Заморозить.", { control: 1.0 }) },
            'ON': { name: 'Пси-Оружие', description: formatDesc('Мы сломим их волю.', 'Враг.', 'Победа.', 'Использование идей.', 'Контроль.'), goals: makeGoals('ON', "Копировать.", { efficiency: 1.0 }) }
        },
        4: { // Анти-Истина
            'SR': { name: 'Галлюцинация', description: formatDesc('Мир горит!', 'Реальность.', 'Иллюзия.', 'Создание ложного.', 'Обман.'), goals: makeGoals('SR', "Сломать.", { power_status: 0.8 }) },
            'OR': { name: 'Диссонанс', description: formatDesc('Истина мерцает.', 'Нестабильность.', 'Ясность.', 'Колебание.', 'Покой.'), goals: makeGoals('OR', "Бояться.", { control: 0.0 }) },
            'SN': { name: 'Субъективность', description: formatDesc('Для нас это правда.', 'Мир.', 'Согласие.', 'Своя правда.', 'Свой мир.'), goals: makeGoals('SN', "Заглушить.", { control: 1.0 }) },
            'ON': { name: 'Мимикрия', description: formatDesc('Я — то, что ты хочешь.', 'Наблюдатель.', 'Скрытность.', 'Иллюзия.', 'Тень.'), goals: makeGoals('ON', "Найти слабость.", { truth: 0.8 }) }
        },
        // Physical Domain
        5: { // Анти-Форма
            'SR': { name: 'Терраформинг', description: formatDesc('Мы искривим пространство.', 'Ландшафт.', 'Хаос.', 'Искривление.', 'Кошмар.'), goals: makeGoals('SR', "Вторгнуться.", { free_flow: 1.0 }) },
            'OR': { name: 'Глитч', description: formatDesc('Стена была здесь.', 'Аномалия.', 'Стабильность.', 'Сбой.', 'Коллапс.'), goals: makeGoals('OR', "Удержать.", { control: 0.9 }) },
            'SN': { name: 'Живой Город', description: formatDesc('Город растёт сам.', 'Структура.', 'Рост.', 'Органическая архитектура.', 'Жизнь.'), goals: makeGoals('SN', "Разделить.", { control: 1.0 }) },
            'ON': { name: 'Разлом', description: formatDesc('Под ногами врага.', 'Поле боя.', 'Уничтожение.', 'Атака аномалией.', 'Победа.'), goals: makeGoals('ON', "Блокировать.", { efficiency: 1.0 }) }
        },
        6: { // Анти-Связь
            'SR': { name: 'Слизь', description: formatDesc('Всё станет одним.', 'Материя.', 'Единство.', 'Поглощение.', 'Масса.'), goals: makeGoals('SR', "Питаться.", { care: -0.5 }) },
            'OR': { name: 'Распад', description: formatDesc('Броня рассыпалась.', 'Объект.', 'Целостность.', 'Разрушение.', 'Пыль.'), goals: makeGoals('OR', "Поглощать.", { escape_transcend: 0.8 }) },
            'SN': { name: 'Симбионт', description: formatDesc('Эта плоть — броня.', 'Организм.', 'Сила.', 'Мутация.', 'Совершенство.'), goals: makeGoals('SN', "Ограничить.", { control: 0.9 }) },
            'ON': { name: 'Вирус', description: formatDesc('Заразим их распадом.', 'Враг.', 'Смерть.', 'Применение мутагена.', 'Победа.'), goals: makeGoals('ON', "Качать.", { efficiency: 1.0 }) }
        },
        7: { // Анти-Рост
            'SR': { name: 'Инвазия', description: formatDesc('Мы вытесним вас.', 'Экосистема.', 'Доминирование.', 'Создание монстров.', 'Захват.'), goals: makeGoals('SR', "Срастить.", { fix_world: 0.8 }) },
            'OR': { name: 'Спонтанность', description: formatDesc('Тварь из камня.', 'Материя.', 'Жизнь.', 'Аномальное рождение.', 'Хаос.'), goals: makeGoals('OR', "Разрушить.", { chaos_change: 0.7 }) },
            'SN': { name: 'Чуждая Жизнь', description: formatDesc('Наши законы.', 'Мир.', 'Гармония.', 'Иной баланс.', 'Дом.'), goals: makeGoals('SN', "Подменить.", { control: 1.0 }) },
            'ON': { name: 'Ферма', description: formatDesc('Вырастить оружие.', 'Ресурс.', 'Оружие.', 'Создание тварей.', 'Победа.'), goals: makeGoals('ON', "Вращаться.", { efficiency: 1.0 }) }
        },
        8: { // Анти-Распад
            'SR': { name: 'Некроз', description: formatDesc('Всё живое сгниёт.', 'Жизнь.', 'Смерть.', 'Распространение гнили.', 'Тлен.'), goals: makeGoals('SR', "Уничтожить мир.", { chaos_change: 1.0 }) },
            'OR': { name: 'Стазис', description: formatDesc('Тела не разлагаются.', 'Трупы.', 'Чистота.', 'Остановка распада.', 'Вечность.'), goals: makeGoals('OR', "Разложиться.", { escape_transcend: 0.8 }) },
            'SN': { name: 'Гниение', description: formatDesc('Бессмертие в распаде.', 'Агония.', 'Жизнь.', 'Вечное гниение.', 'Существование.'), goals: makeGoals('SN', "Очистить.", { control: 1.0 }) },
            'ON': { name: 'Старение', description: formatDesc('Состарю их.', 'Враг.', 'Слабость.', 'Ускорение распада.', 'Победа.'), goals: makeGoals('ON', "Сжечь.", { efficiency: 1.0 }) }
        },
        // Temporal Domain
        9: { // Анти-Цикл
            'SR': { name: 'Темпоральная Атака', description: formatDesc('Состарю за миг.', 'Время.', 'Хаос.', 'Ускорение/замедление.', 'Победа.'), goals: makeGoals('SR', "Изменить прошлое.", { power_status: 0.9 }) },
            'OR': { name: 'Асинхрония', description: formatDesc('Время идёт рывками.', 'Поток.', 'Стабильность.', 'Сбои времени.', 'Тишина.'), goals: makeGoals('OR', "Повторить.", { control: 0.8 }) },
            'SN': { name: 'Иной Ритм', description: formatDesc('День — час.', 'Цикл.', 'Норма.', 'Чужой цикл.', 'Вечность.'), goals: makeGoals('SN', "Состарить.", { preserve_order: 1.0 }) },
            'ON': { name: 'Хроно-щит', description: formatDesc('Замедлим снаряды.', 'Бой.', 'Защита.', 'Замедление.', 'Жизнь.'), goals: makeGoals('ON', "Отсчитать.", { efficiency: 1.0 }) }
        },
        10: { // Анти-Путь
            'SR': { name: 'Ловушка', description: formatDesc('Путь в ад.', 'Портал.', 'Смерть.', 'Создание опасных путей.', 'Конец.'), goals: makeGoals('SR', "Завести.", { free_flow: 0.9 }) },
            'OR': { name: 'Тупик', description: formatDesc('Коридор в никуда.', 'Путь.', 'Выход.', 'Исчезновение путей.', 'Пустота.'), goals: makeGoals('OR', "Запутать.", { control: 0.7 }) },
            'SN': { name: 'Тропы Паука', description: formatDesc('Алогичные пути.', 'Геометрия.', 'Проход.', 'Странная сеть.', 'Связь.'), goals: makeGoals('SN', "Перевезти.", { control: 1.0 }) },
            'ON': { name: 'Телепорт', description: formatDesc('За спиной врага.', 'Поле боя.', 'Преимущество.', 'Короткий проход.', 'Победа.'), goals: makeGoals('ON', "Направить.", { efficiency: 1.0 }) }
        },
        11: { // Анти-Причина
            'SR': { name: 'Проклятие', description: formatDesc('Обречён.', 'Судьба.', 'Смерть.', 'Наложение рока.', 'Конец.'), goals: makeGoals('SR', "Мучить.", { power_status: 0.8 }) },
            'OR': { name: 'Сингулярность', description: formatDesc('Взрыв из ничего.', 'Причина.', 'Логика.', 'Сбой.', 'Хаос.'), goals: makeGoals('OR', "Страдать.", { escape_transcend: 0.9 }) },
            'SN': { name: 'Ритуал', description: formatDesc('Ритуал решает.', 'Закон.', 'Победа.', 'Символическая причина.', 'Власть.'), goals: makeGoals('SN', "Вернуть.", { preserve_order: 1.0 }) },
            'ON': { name: 'Аномалия', description: formatDesc('Чудо.', 'Враг.', 'Страх.', 'Создание сбоя.', 'Победа.'), goals: makeGoals('ON', "Ударить.", { efficiency: 1.0 }) }
        },
        12: { // Анти-Смерть
            'SR': { name: 'Зомби-процесс', description: formatDesc('Никогда не кончится.', 'Битва.', 'Конец.', 'Бесконечность.', 'Вечность.'), goals: makeGoals('SR', "Убить.", { power_status: 0.9 }) },
            'OR': { name: 'Зависание', description: formatDesc('Ни жив, ни мёртв.', 'Лимб.', 'Выход.', 'Застывание.', 'Покой.'), goals: makeGoals('OR', "Существовать мертвым.", { escape_transcend: 0.8 }) },
            'SN': { name: 'Петля', description: formatDesc('Снова начало.', 'День.', 'Выход.', 'Замкнутый круг.', 'Повтор.'), goals: makeGoals('SN', "Распространиться.", { control: 0.9 }) },
            'ON': { name: 'Стазис', description: formatDesc('Заморозить.', 'Враг.', 'Победа.', 'Ловушка времени.', 'Лед.'), goals: makeGoals('ON', "Отравить.", { efficiency: 1.0 }) }
        },
        // Vital Domain
        13: { // Анти-Личность
            'SR': { name: 'Похититель', description: formatDesc('Ты станешь мной.', 'Личность.', 'Единство.', 'Ассимиляция.', 'Я.'), goals: makeGoals('SR', "Подчинить.", { power_status: 1.0 }) },
            'OR': { name: 'Дереализация', description: formatDesc('Не моё тело.', 'Реальность.', 'Себя.', 'Потеря Я.', 'Ничто.'), goals: makeGoals('OR', "Служить.", { control: 0.0 }) },
            'SN': { name: 'R-Идентичность', description: formatDesc('Я — иное.', 'Человек.', 'Стабильность.', 'Новая личность.', 'Покой.'), goals: makeGoals('SN', "Ассимилировать.", { control: 1.0 }) },
            'ON': { name: 'Стиратель', description: formatDesc('Он забудет.', 'Память.', 'Чистота.', 'Амнезия.', 'Пустота.'), goals: makeGoals('ON', "Пометить.", { efficiency: 1.0 }) }
        },
        14: { // Анти-Эмпатия
            'SR': { name: 'Телепат', description: formatDesc('Почувствуй ужас!', 'Эмоции.', 'Боль.', 'Атака чувством.', 'Страх.'), goals: makeGoals('SR', "Заманить.", { power_status: 0.8 }) },
            'OR': { name: 'Анестезия', description: formatDesc('Ничего не чувствую.', 'Эмпатия.', 'Чувство.', 'Потеря чувств.', 'Тишина.'), goals: makeGoals('OR', "Молчать.", { care: 0.2 }) },
            'SN': { name: 'Улей', description: formatDesc('Чувствуем как один.', 'Боль.', 'Единство.', 'Общее чувство.', 'Мы.'), goals: makeGoals('SN', "Связать договором.", { control: 1.0 }) },
            'ON': { name: 'Модулятор', description: formatDesc('Отключим страх.', 'Солдат.', 'Эффективность.', 'Контроль эмоций.', 'Победа.'), goals: makeGoals('ON', "Проникнуть.", { truth: 0.8 }) }
        },
        15: { // Анти-Воля
            'SR': { name: 'Одержимость', description: formatDesc('Движешься по моей воле.', 'Тело.', 'Контроль.', 'Захват.', 'Власть.'), goals: makeGoals('SR', "Управлять скрыто.", { power_status: 0.9 }) },
            'OR': { name: 'Апатия', description: formatDesc('Не могу.', 'Решение.', 'Действие.', 'Паралич.', 'Покой.'), goals: makeGoals('OR', "Быть использованным.", { control: 0.0 }) },
            'SN': { name: 'Инстинкт', description: formatDesc('Воля роя.', 'Выбор.', 'Импульс.', 'Коллективная воля.', 'Мы.'), goals: makeGoals('SN', "Родить монстров.", { care: 0.5 }) },
            'ON': { name: 'Интерфейс', description: formatDesc('Управляю мыслью.', 'Дрон.', 'Послушание.', 'Прямой контроль.', 'Власть.'), goals: makeGoals('ON', "Удержать.", { efficiency: 1.0 }) }
        },
        16: { // Анти-Память
            'SR': { name: 'Имплант', description: formatDesc('Ложная память.', 'Прошлое.', 'История.', 'Создание лжи.', 'Вера.'), goals: makeGoals('SR', "Поглотить суть.", { care: -0.5 }) },
            'OR': { name: 'Дежавю', description: formatDesc('Уже было.', 'Память.', 'Ясность.', 'Сбой.', 'Забвение.'), goals: makeGoals('OR', "Имитировать жизнь.", { escape_transcend: 0.9 }) },
            'SN': { name: 'Память Улья', description: formatDesc('Одна история.', 'Личность.', 'Общее.', 'Единый нарратив.', 'Мы.'), goals: makeGoals('SN', "Обратить в веру.", { control: 1.0 }) },
            'ON': { name: 'Промывка', description: formatDesc('Будет верить.', 'Мозг.', 'Лояльность.', 'Перезапись.', 'Служение.'), goals: makeGoals('ON', "Отразить.", { truth: 0.7 }) }
        },
    }
};

export const getArchetypeData = (lambda: string, f: number, mu: string): ArchetypeData | undefined => {
    return archetypesContentData[lambda]?.[f]?.[mu];
}

// Full list of all archetypes for visualization
export const allArchetypes = (() => {
    const points = [];
    for (const lambda of ['H', 'D', 'O']) {
        for (let f = 1; f <= 16; f++) {
            for (const mu of ['SR', 'OR', 'SN', 'ON']) {
                const data = getArchetypeData(lambda, f, mu);
                if (data) {
                    points.push({
                        id: `${lambda}-${f}-${mu}`,
                        lambda, f, mu,
                        data,
                        metrics: calculateArchetypeMetrics(lambda, f, mu),
                    });
                }
            }
        }
    }
    return points;
})();
    