# Axis Space — оси, вектор, метрики

## 0) Источники истины

- Схема осей и их семантика/диапазоны: `data/character-schema.ts` (`characterSchema`).
- Вектор персонажа: `CharacterEntity.vector_base` (`types.ts`).

## 1) Что такое ось

Ось — это скалярный параметр, который живёт в фиксированном диапазоне.
В текущей модели **психологические/поведенческие оси** в `vector_base` почти всегда в **[0,1]**.

`characterSchema` организован по группам (A,B,C,D,E,F,G и также блоки body/legacy/resources/...)

- Группы A–G: идеологические/поведенческие/социальные/телесные/когнитивные/пластичность/идентичность.
- `body_*` / `resources` / `authority` / etc.: реальные величины с единицами и `path` в `CharacterEntity` (не в `vector_base`).

Контракт: если ось находится в `vector_base`, то:

- значение должно быть конечным числом;
- если ось не указана — **по умолчанию 0.5** (нейтраль) в большинстве вычислений (см. ToM: `a[axis] ?? 0.5`).

## 2) Нормировка и клиппинг

В коде повсеместно применяется клиппинг:

\[
\mathrm{clamp01}(x)=\min(1,\max(0,x))
\]

(см. `lib/context/lens/characterLens.ts`, `lib/graph/atomEnergy.ts`).

Практический вывод:
- если ты записала что-то вне [0,1], оно будет обрезано до границ на разных этапах (или превратится в 0, если NaN).

## 3) Метрики похожести и различия (используются в ToM)

### 3.1 Похожесть по оси

В ToM «похожесть» по одной оси задаётся как

\[
\mathrm{sim}(a,b)=1-|a-b|\quad\in[0,1]
\]

(`simAxis` в `lib/tom/dyad-metrics.ts`).

### 3.2 Взвешенная похожесть по набору осей

Для набора осей с весами \(w_i\):

\[
\mathrm{Sim}_W(a,b)=\frac{\sum_i w_i\,\mathrm{sim}(a_i,b_i)}{\sum_i |w_i|}
\]

(`weightedSim`). Если знаменатель 0 → возвращается 0.

### 3.3 «Уровень партнёра» (partner level)

\[
\mathrm{PartnerLevel}_W(b)=\frac{\sum_i w_i\,b_i}{\sum_i |w_i|}
\]

(`weightedPartnerLevel`). Это «насколько у B высоки ценимые качества».

### 3.4 Доминантность как разность

\[
\mathrm{domAxis}(a,b)=b-a\in[-1,1]
\]

\[
\mathrm{Dom}_W(a,b)=\frac{\sum_i w_i\,(b_i-a_i)}{\sum_i |w_i|}
\]

(`weightedDom`).

### 3.5 «Угроза»

В текущей реализации угроза — это просто уровень партнёра по угрожающим осям:

\[
\mathrm{Threat}_W(b)=\frac{\sum_i w_i\,b_i}{\sum_i |w_i|}
\]

(`weightedThreat`).

## 4) Как добавлять новую ось (правильно)

1) Добавь ось в `data/character-schema.ts` (в соответствующий раздел) с:
   - `name`, `description`, `min/max/step`, `importance`.
2) Если ось должна жить в `vector_base` — используй ключ как id оси.
3) Если ось должна жить внутри `CharacterEntity` (body/resources/authority...) — укажи `path` и веди её через атомы `feat:char:*`/`world:*`.
4) Если ось должна влиять на субъективность/ToM/Goals — **дальше** нужно:
   - (Lens) подключить её в `lib/context/lens/characterLens.ts` как `feat:char:<id>:trait.*` или как ctx-ось;
   - (ToM) добавить веса в `data/tom-dyad-configs.ts` (или в конфиг конкретного персонажа);
   - (Goal Lab) добавить влияние в `lib/goals/goalAtoms.ts` (через `ctx:prio:*` или прямые веса).

Важно: *сама по себе* добавленная ось в schema не меняет поведение системы.

## 5) Что считается «нейтральной точкой»

- Для большинства осей: \(0.5\) — нейтраль.
- Для ToM: отсутствие оси в векторе трактуется как \(0.5\).
- Для линзы: при trait/body = 0.5 линза старается быть почти тождественной (см. `03_CHARACTER_LENS.md`).
